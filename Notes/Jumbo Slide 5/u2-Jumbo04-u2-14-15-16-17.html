<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Tips for effective data visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content="datasciencebox.org" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="../xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="../slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Tips for effective data visualization
## <br><br> Data Science in a Box
### <a href="https://datasciencebox.org/">datasciencebox.org</a>

---





layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://datasciencebox.org" target="_blank"&gt;datasciencebox.org&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---



class: middle

# Designing effective visualizations

---

## Keep it simple

.pull-left-narrow[
&lt;img src="img/pie-3d.jpg" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right-wide[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/pie-to-bar-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]



---

## Use	color	to	draw	attention

.pull-left[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-2-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Tell a story

&lt;img src="img/time-series-story.png" width="80%" style="display: block; margin: auto;" /&gt;

.footnote[
Credit: Angela Zoss and Eric Monson, Duke DVS
]

---

class: middle

# Principles	for	effective	visualizations

---

## Principles	for	effective	visualizations

- Order matters
- Put long categories on the y-axis
- Keep	scales consistent
- Select meaningful colors
- Use meaningful and nonredundant labels

---

## Data

In September 2019, YouGov survey asked 1,639 GB adults the following question:

.pull-left[
&gt; In hindsight, do you think Britain was right/wrong to vote to leave EU?
&gt;
&gt;- Right to leave  
&gt;- Wrong to leave  
&gt;- Don't know

]
.pull-right[


&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.footnote[ 
Source: [YouGov Survey Results](https://d25d2506sfb94s.cloudfront.net/cumulus_uploads/document/x0msmggx08/YouGov%20-%20Brexit%20and%202019%20election.pdf), retrieved Oct 7, 2019
]

---

class: middle

# Order matters

---

## Alphabetical order is rarely ideal

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-7-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(brexit, aes(x = opinion)) +
  geom_bar()
```
]

]

---

## Order by frequency

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-8-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

`fct_infreq`: Reorder factors' levels by frequency


```r
*ggplot(brexit, aes(x = fct_infreq(opinion))) +
  geom_bar()
```
]

]

---

## Clean up labels

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-9-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(x = opinion)) +
  geom_bar() +
* labs(
*   x = "Opinion",
*   y = "Count"
* )
```
]

]

---

## Alphabetical order is rarely ideal

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-10-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(x = region)) +
  geom_bar()
```
]

]

---

## Use inherent level order

.panelset[

.panel[.panel-name[Relevel]

`fct_relevel`: Reorder factor levels using a custom order


```r
brexit &lt;- brexit %&gt;%
  mutate(
*   region = fct_relevel(
      region,
      "london", "rest_of_south", "midlands_wales", "north", "scot"
    )
  )
```
]

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-11-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

]

---

## Clean up labels

.panelset[

.panel[.panel-name[Recode]

`fct_recode`: Change factor levels by hand


```r
brexit &lt;- brexit %&gt;%
  mutate(
*   region = fct_recode(
      region,
      London = "london",
      `Rest of South` = "rest_of_south",
      `Midlands / Wales` = "midlands_wales",
      North = "north",
      Scotland = "scot"
    )
  )
```
]

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/recode-plot-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

]

---

class: middle

# Put long categories on the y-axis

---

## Long categories can be hard to read

&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-12-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Move them to the y-axis

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-13-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
*ggplot(brexit, aes(y = region)) +
  geom_bar()
```
]

]

---

## And reverse the order of levels

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-14-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

`fct_rev`: Reverse order of factor levels


```r
*ggplot(brexit, aes(y = fct_rev(region))) +
  geom_bar()
```
]

]

---

## Clean up labels

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-15-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = fct_rev(region))) +
  geom_bar() +
* labs(
*   x = "Count",
*   y = "Region"
* )
```
]

]

---

class: middle

# Pick a purpose

---

## Segmented bar plots can be hard to read

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-16-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
*ggplot(brexit, aes(y = region, fill = opinion)) +
  geom_bar()
```
]

]

---

## Use facets

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-17-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = region)) +
  geom_bar() +
* facet_wrap(~region, nrow = 1)
```
]

]

---

## Avoid redundancy?

&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-18-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Redundancy can help tell a story

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-19-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1)
```
]

]

---

## Be selective with redundancy

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-20-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
* guides(fill = "none")
```
]

]

---

## Use informative labels

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-21-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
  guides(fill = "none") +
  labs(
*   title = "Was Britain right/wrong to vote to leave EU?",
    x = NULL, y = NULL
  )
```
]

]

---

## A bit more info

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-22-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
  guides(fill = "none") +
  labs(
    title = "Was Britain right/wrong to vote to leave EU?",
*   subtitle = "YouGov Survey Results, 2-3 September 2019",
*   caption = "Source: https://d25d2506sfb94s.cloudfront.net/cumulus_uploads/document/x0msmggx08/YouGov%20-%20Brexit%20and%202019%20election.pdf",
    x = NULL, y = NULL
  )
```
]

]

---

## Let's do better

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-23-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
  guides(fill = "none") +
  labs(
    title = "Was Britain right/wrong to vote to leave EU?",
    subtitle = "YouGov Survey Results, 2-3 September 2019",
*   caption = "Source: bit.ly/2lCJZVg",
    x = NULL, y = NULL
  )
```
]

]

---

## Fix up facet labels

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-24-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region,
    nrow = 1,
*   labeller = label_wrap_gen(width = 12)
  ) + 
  guides(fill = "none") +
  labs(
    title = "Was Britain right/wrong to vote to leave EU?",
    subtitle = "YouGov Survey Results, 2-3 September 2019",
    caption = "Source: bit.ly/2lCJZVg",
    x = NULL, y = NULL
  )
```
]

]

---

class: middle

# Select meaningful colors

---

## Rainbow colors not always the right choice

&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-25-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Manually choose colors when needed

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-26-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1, labeller = label_wrap_gen(width = 12)) +
  guides(fill = "none") +
  labs(title = "Was Britain right/wrong to vote to leave EU?",
       subtitle = "YouGov Survey Results, 2-3 September 2019",
       caption = "Source: bit.ly/2lCJZVg",
       x = NULL, y = NULL) +
* scale_fill_manual(values = c(
*   "Wrong" = "red",
*   "Right" = "green",
*   "Don't know" = "gray"
* ))
```
]

]

---

## Choosing better colors

.center[.large[
[colorbrewer2.org](https://colorbrewer2.org/)
]]

&lt;img src="img/color-brewer.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Use better colors

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-28-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1, labeller = label_wrap_gen(width = 12)) +
  guides(fill = "none") +
  labs(title = "Was Britain right/wrong to vote to leave EU?",
       subtitle = "YouGov Survey Results, 2-3 September 2019",
       caption = "Source: bit.ly/2lCJZVg",
       x = NULL, y = NULL) +
  scale_fill_manual(values = c(
*   "Wrong" = "#ef8a62",
*   "Right" = "#67a9cf",
*   "Don't know" = "gray"
  ))
```
]

]

---

## Select theme

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-29-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1, labeller = label_wrap_gen(width = 12)) +
  guides(fill = "none") +
  labs(title = "Was Britain right/wrong to vote to leave EU?",
       subtitle = "YouGov Survey Results, 2-3 September 2019",
       caption = "Source: bit.ly/2lCJZVg",
       x = NULL, y = NULL) +
  scale_fill_manual(values = c("Wrong" = "#ef8a62",
                               "Right" = "#67a9cf",
                               "Don't know" = "gray")) +
* theme_minimal()
```
]

]

---

.your-turn[
### .hand[Your turn!]
.midi[
- RStudio Cloud &gt; `AE 07 - Brexit + Telling stories with dataviz` &gt; `brexit.Rmd`. 
- Change the visualisation in three different ways to tell slightly different stories with it each time.
]
]


---

class: middle

# Scientific studies

---

## Scientific studies

.pull-left[
**Observational**  
- Collect data in a way that does not interfere with how the data arise ("observe")
- Establish associations
]
.pull-right[
**Experimental**  
- Randomly assign subjects to treatments
- Establish causal connections
]

---

.question[
What type of study is the following, observational or experiment? What does that mean in terms of causal conclusions?

*Researchers studying the relationship between exercising and energy levels asked participants in their study how many times a week they exercise and whether they have high or low energy when they wake up in the morning.*

*Based on responses to the exercise question the researchers grouped people into three categories (no exercise, exercise 1-3 times a week, and exercise more than 3 times a week).* 

*The researchers then compared the proportions of people who said they have high energy in the mornings across the three exercise categories.*
]

---

.question[
What type of study is the following, observational or experiment? What does that mean in terms of causal conclusions?

*Researchers studying the relationship between exercising and energy levels randomly assigned participants in their study into three groups: no exercise, exercise 1-3 times a week, and exercise more than 3 times a week.* 

*After one week, participants were asked whether they have high or low energy when they wake up in the morning.*

*The researchers then compared the proportions of people who said they have high energy in the mornings across the three exercise categories.*
]

---

class: middle

# Case study: Breakfast cereal keeps girls slim

---


.midi[
&gt; *Girls who ate breakfast of any type had a lower average body mass index (BMI), a common obesity gauge, than those who said they didn't. The index was even lower for girls who said they ate cereal for breakfast, according to findings of the study conducted by the Maryland Medical Research Institute with funding from the National Institutes of Health (NIH) and cereal-maker General Mills.* [...]
&gt;
&gt; *The results were gleaned from a larger NIH survey of 2,379 girls in California, Ohio, and Maryland who were tracked between the ages of 9 and 19.* [...]
&gt;
&gt;*As part of the survey, the girls were asked once a year what they had eaten during the previous three days.* [...]
]

.footnote[
Souce: [Study: Cereal Keeps Girls Slim](https://www.cbsnews.com/news/study-cereal-keeps-girls-slim/), Retrieved Sep 13, 2018.
]

---

## Explanatory and response variables

- Explanatory variable: Whether the participant ate breakfast or not

- Reponse variable: BMI of the participant


---

## Three possible explanations

--

1. Eating breakfast causes girls to be slimmer 


--
2. Being slim causes girls to eat breakfast


--
3. A third variable is responsible for both -- a **confounding** variable: an extraneous variable that affects both the explanatory and the response variable, and that makes it seem like there is a relationship between them

---

## Correlation != causation

&lt;img src="img/xkcdcorrelation.png" width="80%" height="50%" style="display: block; margin: auto;" /&gt;

.footnote[
Randall Munroe CC BY-NC 2.5 http://xkcd.com/552/
]

---

## Studies and conclusions

&lt;img src="img/random_sample_assign_grid.png" width="80%" height="50%" style="display: block; margin: auto;" /&gt;

---

class: middle

# Case study: Climate change survey

---

## Survey question

&gt;A July 2019 YouGov survey asked 1633 GB and 1333 USA randomly selected adults 
which of the following statements about the global environment best describes 
their view:
&gt;
&gt;- The climate is changing and human activity is mainly responsible  
&gt;- The climate is changing and human activity is partly responsible, together with other factors  
&gt;- The climate is changing but human activity is not responsible at all  
&gt;- The climate is not changing  

---

## Survey data

&lt;br&gt;

.small[


&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is mainly responsible &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is partly responsible, together with other factors &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing but human activity is not responsible at all &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is not changing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Don't know &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GB &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 833 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 604 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1633 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; US &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 507 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 493 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 133 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1333 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1340 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1097 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 169 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 113 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2966 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

.footnote[
Source: [YouGov - International Climate Change Survey](https://d25d2506sfb94s.cloudfront.net/cumulus_uploads/document/epjj0nusce/YouGov%20-%20International%20climate%20change%20survey.pdf)
]

---

.question[
What percent of **all respondents** think the climate is changing and  
human activity is mainly responsible?  
]

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is mainly responsible &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is partly responsible, together with other factors &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing but human activity is not responsible at all &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is not changing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Don't know &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GB &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 833 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 604 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1633 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; US &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 507 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 493 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 133 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1333 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1340 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1097 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 169 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 113 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2966 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--


```r
(all &lt;- 1340 / 2966)
```

```
## [1] 0.4517869
```


---

.question[
What percent of **GB respondents** think the climate is changing and  
human activity is mainly responsible?  
]

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is mainly responsible &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is partly responsible, together with other factors &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing but human activity is not responsible at all &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is not changing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Don't know &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GB &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 833 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 604 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1633 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; US &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 507 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 493 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 133 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1333 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1340 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1097 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 169 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 113 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2966 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--


```r
(gb &lt;- 833 / 1633)
```

```
## [1] 0.5101041
```

---

.question[
What percent of **US respondents** think the climate is changing and  
human activity is mainly responsible?  
]

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is mainly responsible &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing and human activity is partly responsible, together with other factors &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is changing but human activity is not responsible at all &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; The climate is not changing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Don't know &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Sum &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GB &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 833 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 604 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 49 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 114 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1633 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; US &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 507 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 493 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 120 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 80 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 133 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1333 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Sum &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1340 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 1097 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 169 &lt;/td&gt;
   &lt;td style="text-align:right;width: 0.5 in; "&gt; 113 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 247 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2966 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--


```r
(us &lt;- 507 / 1333)
```

```
## [1] 0.3803451
```

---

.question[
Based on the percentages we calculated, does there appear to be a relationship 
between country and beliefs about climate change? If yes, could there be another variable that explains this relationship?
]

.pull-left[

```r
all
```

```
## [1] 0.4517869
```

```r
gb
```

```
## [1] 0.5101041
```

```r
us
```

```
## [1] 0.3803451
```
]

---

## Conditional probability

**Notation**: `\(P(A | B)\)`: Probability of event A given event B

- What is the probability that it will be unseasonably warm tomorrow?
- What is the probability that it will be unseasonably warm tomorrow, given that it was unseasonably warm today?

---

## Independence

- If knowing event A happened tells you something about event B happening, or vice versa, then events A and B are not independent

- If not, they are said to be independent

- `\(P(A | B) = P(A)\)`

---


class: middle

# Case study: Berkeley admission data

---

## Berkeley admission data

- Study carried out by the Graduate Division of the University of California, Berkeley in the early 70â€™s to evaluate whether there was a gender bias in graduate admissions.
- The data come from six departments. For confidentiality we'll call them A-F. 
- We have information on whether the applicant was male or female and whether they were admitted or rejected. 
- First, we will evaluate whether the percentage of males admitted is indeed higher than females, overall. Next, we will calculate the same percentage for each department.

---

## Data

.pull-left[

```
## # A tibble: 4,526 x 3
##    admit    gender dept 
##    &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
##  1 Admitted Male   A    
##  2 Admitted Male   A    
##  3 Admitted Male   A    
##  4 Admitted Male   A    
##  5 Admitted Male   A    
##  6 Admitted Male   A    
##  7 Admitted Male   A    
##  8 Admitted Male   A    
##  9 Admitted Male   A    
## 10 Admitted Male   A    
## 11 Admitted Male   A    
## 12 Admitted Male   A    
## 13 Admitted Male   A    
## 14 Admitted Male   A    
## 15 Admitted Male   A    
## # ... with 4,511 more rows
```
]
.pull-right[

```
## # A tibble: 2 x 2
##   gender     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```

```
## # A tibble: 6 x 2
##   dept      n
##   &lt;ord&gt; &lt;int&gt;
## 1 A       933
## 2 B       585
## 3 C       918
## 4 D       792
## 5 E       584
## 6 F       714
```

```
## # A tibble: 2 x 2
##   admit        n
##   &lt;fct&gt;    &lt;int&gt;
## 1 Rejected  2771
## 2 Admitted  1755
```
]

---

.question[
What can you say about the overall gender distribution? Hint: Calculate the following probabilities: `\(P(Admit | Male)\)` and `\(P(Admit | Female)\)`.
]


```r
ucbadmit %&gt;%
  count(gender, admit)
```

```
## # A tibble: 4 x 3
##   gender admit        n
##   &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;
## 1 Female Rejected  1278
## 2 Female Admitted   557
## 3 Male   Rejected  1493
## 4 Male   Admitted  1198
```

---


```r
ucbadmit %&gt;%
  count(gender, admit) %&gt;%
  group_by(gender) %&gt;%
  mutate(prop_admit = n / sum(n))
```

```
## # A tibble: 4 x 4
## # Groups:   gender [2]
##   gender admit        n prop_admit
##   &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 Female Rejected  1278      0.696
## 2 Female Admitted   557      0.304
## 3 Male   Rejected  1493      0.555
## 4 Male   Admitted  1198      0.445
```

- `\(P(Admit | Female)\)` = 0.304
- `\(P(Admit | Male)\)` = 0.445

---

## Overall gender distribution

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-43-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(ucbadmit, aes(y = gender, fill = admit)) +
  geom_bar(position = "fill") + 
  labs(title = "Admit by gender",
       y = NULL, x = NULL)
```
]

]

---

.question[
What can you say about the gender distribution by department ?
]


```r
ucbadmit %&gt;%
  count(dept, gender, admit)
```

```
## # A tibble: 24 x 4
##   dept  gender admit        n
##   &lt;ord&gt; &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;
## 1 A     Female Rejected    19
## 2 A     Female Admitted    89
## 3 A     Male   Rejected   313
## 4 A     Male   Admitted   512
## 5 B     Female Rejected     8
## 6 B     Female Admitted    17
## # ... with 18 more rows
```

???

Note that this is hard to calculate with the current format of the data. Lets pivot wider. 

---

.question[
Let's try again... What can you say about the gender distribution by department?
]


```r
ucbadmit %&gt;%
  count(dept, gender, admit) %&gt;%
  pivot_wider(names_from = dept, values_from = n)
```

```
## # A tibble: 4 x 8
##   gender admit        A     B     C     D     E     F
##   &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 Female Rejected    19     8   391   244   299   317
## 2 Female Admitted    89    17   202   131    94    24
## 3 Male   Rejected   313   207   205   279   138   351
## 4 Male   Admitted   512   353   120   138    53    22
```

---

## Gender distribution, by department

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-46-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(ucbadmit, aes(y = gender, fill = admit)) +
  geom_bar(position = "fill") +
  facet_wrap(. ~ dept) +
  scale_x_continuous(labels = label_percent()) +
  labs(title = "Admissions by gender and department",
       x = NULL, y = NULL, fill = NULL) +
  theme(legend.position = "bottom")
```
]

]

---

## Case for gender discrimination?

.pull-left[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-47-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-48-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Closer look at departments

.panelset[

.panel[.panel-name[Output]

```
## # A tibble: 12 x 5
## # Groups:   dept, gender [12]
##    dept  gender n_admitted n_applied prop_admit
##    &lt;ord&gt; &lt;fct&gt;       &lt;int&gt;     &lt;int&gt;      &lt;dbl&gt;
##  1 A     Female         89       108     0.824 
##  2 A     Male          512       825     0.621 
##  3 B     Female         17        25     0.68  
##  4 B     Male          353       560     0.630 
##  5 C     Female        202       593     0.341 
##  6 C     Male          120       325     0.369 
##  7 D     Female        131       375     0.349 
##  8 D     Male          138       417     0.331 
##  9 E     Female         94       393     0.239 
## 10 E     Male           53       191     0.277 
## 11 F     Female         24       341     0.0704
## 12 F     Male           22       373     0.0590
```
]

.panel[.panel-name[Code]

```r
ucbadmit %&gt;%
  count(dept, gender, admit) %&gt;%
  group_by(dept, gender) %&gt;%
  mutate(
    n_applied  = sum(n),
    prop_admit = n / n_applied
    ) %&gt;%
  filter(admit == "Admitted") %&gt;%
  rename(n_admitted = n) %&gt;%
  select(-admit) %&gt;%
  print(n = 12)
```
]

]

---

class: middle

# Simpson's paradox

---

## Relationship between two variables

.pull-left[

```
## # A tibble: 8 x 3
##       x     y z    
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     4 A    
## 2     3     3 A    
## 3     4     2 A    
## 4     5     1 A    
## 5     6    11 B    
## 6     7    10 B    
## # ... with 2 more rows
```
]
.pull-right[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-51-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Relationship between two variables

.pull-left[

```
## # A tibble: 8 x 3
##       x     y z    
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     4 A    
## 2     3     3 A    
## 3     4     2 A    
## 4     5     1 A    
## 5     6    11 B    
## 6     7    10 B    
## # ... with 2 more rows
```
]
.pull-right[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-53-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Considering a third variable

.pull-left[

```
## # A tibble: 8 x 3
##       x     y z    
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     4 A    
## 2     3     3 A    
## 3     4     2 A    
## 4     5     1 A    
## 5     6    11 B    
## 6     7    10 B    
## # ... with 2 more rows
```
]
.pull-right[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-55-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Relationship between three variables

.pull-left[

```
## # A tibble: 8 x 3
##       x     y z    
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     4 A    
## 2     3     3 A    
## 3     4     2 A    
## 4     5     1 A    
## 5     6    11 B    
## 6     7    10 B    
## # ... with 2 more rows
```
]
.pull-right[
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-57-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Simpson's paradox

- Not considering an important variable when studying a relationship can result in **Simpson's paradox**
- Simpson's paradox illustrates the effect that omission of an explanatory variable can have on the measure of association between another explanatory variable and a response variable
- The inclusion of a third variable in the analysis can change the apparent relationship between the other two variables

---

class: middle

# Aside: `group_by()` and `count()`

---

## What does group_by() do?

`group_by()` takes an existing data frame and converts it into a grouped data frame where subsequent operations are performed "once per group"

.pull-left[

```r
ucbadmit
```

```
## # A tibble: 4,526 x 3
##   admit    gender dept 
##   &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
## 1 Admitted Male   A    
## 2 Admitted Male   A    
## 3 Admitted Male   A    
## 4 Admitted Male   A    
## 5 Admitted Male   A    
## 6 Admitted Male   A    
## # ... with 4,520 more rows
```
]
.pull-right[

```r
ucbadmit %&gt;% 
  group_by(gender)
```

```
## # A tibble: 4,526 x 3
## # Groups:   gender [2]
##   admit    gender dept 
##   &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
## 1 Admitted Male   A    
## 2 Admitted Male   A    
## 3 Admitted Male   A    
## 4 Admitted Male   A    
## 5 Admitted Male   A    
## 6 Admitted Male   A    
## # ... with 4,520 more rows
```
]

---

## What does group_by() not do?

`group_by()` does not sort the data, `arrange()` does

.pull-left[

```r
ucbadmit %&gt;% 
  group_by(gender)
```

```
## # A tibble: 4,526 x 3
## # Groups:   gender [2]
##   admit    gender dept 
##   &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
## 1 Admitted Male   A    
## 2 Admitted Male   A    
## 3 Admitted Male   A    
## 4 Admitted Male   A    
## 5 Admitted Male   A    
## 6 Admitted Male   A    
## # ... with 4,520 more rows
```
]
.pull-right[

```r
ucbadmit %&gt;% 
  arrange(gender)
```

```
## # A tibble: 4,526 x 3
##   admit    gender dept 
##   &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
## 1 Admitted Female A    
## 2 Admitted Female A    
## 3 Admitted Female A    
## 4 Admitted Female A    
## 5 Admitted Female A    
## 6 Admitted Female A    
## # ... with 4,520 more rows
```
]

---

## What does group_by() not do?

`group_by()` does not create frequency tables, `count()` does

.pull-left[

```r
ucbadmit %&gt;% 
  group_by(gender)
```

```
## # A tibble: 4,526 x 3
## # Groups:   gender [2]
##   admit    gender dept 
##   &lt;fct&gt;    &lt;fct&gt;  &lt;ord&gt;
## 1 Admitted Male   A    
## 2 Admitted Male   A    
## 3 Admitted Male   A    
## 4 Admitted Male   A    
## 5 Admitted Male   A    
## 6 Admitted Male   A    
## # ... with 4,520 more rows
```
]
.pull-right[

```r
ucbadmit %&gt;% 
  count(gender)
```

```
## # A tibble: 2 x 2
##   gender     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```
]

---

## Undo grouping with ungroup()

.pull-left[

```r
ucbadmit %&gt;%
  count(gender, admit) %&gt;%
  group_by(gender) %&gt;%
  mutate(prop_admit = n / sum(n)) %&gt;%
  select(gender, prop_admit)
```

```
## # A tibble: 4 x 2
## # Groups:   gender [2]
##   gender prop_admit
##   &lt;fct&gt;       &lt;dbl&gt;
## 1 Female      0.696
## 2 Female      0.304
## 3 Male        0.555
## 4 Male        0.445
```
]
.pull-right[

```r
ucbadmit %&gt;%
  count(gender, admit) %&gt;%
  group_by(gender) %&gt;%
  mutate(prop_admit = n / sum(n)) %&gt;%
  select(gender, prop_admit) %&gt;%
  ungroup()
```

```
## # A tibble: 4 x 2
##   gender prop_admit
##   &lt;fct&gt;       &lt;dbl&gt;
## 1 Female      0.696
## 2 Female      0.304
## 3 Male        0.555
## 4 Male        0.445
```
]

---

## count() is a short-hand

`count()` is a short-hand for `group_by()` and then `summarise()` to count the number of observations in each group

.pull-left[

```r
ucbadmit %&gt;%
  group_by(gender) %&gt;%
  summarise(n = n()) 
```

```
## # A tibble: 2 x 2
##   gender     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```
]
.pull-right[

```r
ucbadmit %&gt;%
  count(gender)
```

```
## # A tibble: 2 x 2
##   gender     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 Female  1835
## 2 Male    2691
```
]

---

## count can take multiple arguments

.pull-left[

```r
ucbadmit %&gt;%
  group_by(gender, admit) %&gt;%
  summarise(n = n()) 
```

```
## # A tibble: 4 x 3
## # Groups:   gender [2]
##   gender admit        n
##   &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;
## 1 Female Rejected  1278
## 2 Female Admitted   557
## 3 Male   Rejected  1493
## 4 Male   Admitted  1198
```
]
.pull-right[

```r
ucbadmit %&gt;%
  count(gender, admit)
```

```
## # A tibble: 4 x 3
##   gender admit        n
##   &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;
## 1 Female Rejected  1278
## 2 Female Admitted   557
## 3 Male   Rejected  1493
## 4 Male   Admitted  1198
```
]

---

## `summarise()` after `group_by()`

- `count()` ungroups after itself
- `summarise()` peels off one layer of grouping by default, or you can specify a different behaviour



```r
ucbadmit %&gt;%
  group_by(gender, admit) %&gt;%
  summarise(n = n()) 
```

```
## `summarise()` has grouped output by 'gender'. You can override using the `.groups` argument.
```

```
## # A tibble: 4 x 3
## # Groups:   gender [2]
##   gender admit        n
##   &lt;fct&gt;  &lt;fct&gt;    &lt;int&gt;
## 1 Female Rejected  1278
## 2 Female Admitted   557
## 3 Male   Rejected  1493
## 4 Male   Admitted  1198
```

---

class: middle

# What's in a data analysis?

---

## Five core activities of data analysis

1. Stating and refining the question
1. Exploring the data
1. Building formal statistical models
1. Interpreting the results
1. Communicating the results

.footnote[
Roger D. Peng and Elizabeth Matsui. "The Art of Data Science." A Guide for Anyone Who Works with Data. Skybrude Consulting, LLC (2015).
]

---

class: middle

# Stating and refining the question

---

## Six types of questions

1. **Descriptive:** summarize a characteristic of a set of data
1. **Exploratory:** analyze to see if there are patterns, trends, or relationships between variables (hypothesis generating)
1. **Inferential:** analyze patterns, trends, or relationships in representative data from a population
1. **Predictive:** make predictions for individuals or groups of individuals
1. **Causal:** whether changing one factor will change another factor, on average, in a population
1. **Mechanistic:** explore "how" as opposed to whether

.footnote[
Jeffery T. Leek and Roger D. Peng. "What is the question?." Science 347.6228 (2015): 1314-1315.
]

---

## Ex: COVID-19 and Vitamin D

1. **Descriptive:** frequency of hospitalisations due to COVID-19 in a set of data collected from a group of individuals
--

1. **Exploratory:** examine relationships between a range of dietary factors and COVID-19 hospitalisations
--

1. **Inferential:** examine whether any relationship between taking Vitamin D supplements and COVID-19 hospitalisations found in the sample hold for the population at large

--
1. **Predictive:** what types of people will take Vitamin D supplements during the next year

--
1. **Causal:** whether people with COVID-19 who were randomly assigned to take Vitamin D supplements or those who were not are hospitalised

--
1. **Mechanistic:** how increased vitamin D intake leads to a reduction in the number of viral illnesses

---

## Questions to data science problems

- Do you have appropriate data to answer your question?
- Do you have information on confounding variables?
- Was the data you're working with collected in a way that introduces bias?

--

.question[
Suppose I want to estimate the average number of children in households in Edinburgh. I conduct a survey at an elementary school in Edinburgh and ask students at this elementary school how many children, including themselves, live in their house. Then, I take the average of the responses. Is this a biased or an unbiased estimate of the number of children in households in Edinburgh? If biased, will the value be an overestimate or underestimate?
]

---

class: middle

# Exploratory data analysis

---

## Checklist

- Formulate your question
- Read in your data
- Check the dimensions
- Look at the top and the bottom of your data
- Validate with at least one external data source
- Make a plot
- Try the easy solution first

---

## Formulate your question

- Consider scope:
  - Are air pollution levels higher on the east coast than on the west coast?
  - Are hourly ozone levels on average higher in New York City than they are in Los Angeles?
  - Do counties in the eastern United States have higher ozone levels than counties in the western United States?
- Most importantly: "Do I have the right data to answer this question?"

---

## Read in your data

- Place your data in a folder called `data`
- Read it into R with `read_csv()` or friends (`read_delim()`, `read_excel()`, etc.)


```r
library(readxl)
fav_food &lt;- read_excel("data/favourite-food.xlsx")
fav_food
```

```
## # A tibble: 5 x 6
##   `Student ID` `Full Name`  favourite.food  mealPlan  AGE   SES  
##          &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;
## 1            1 Sunil Huffm~ Strawberry yog~ Lunch on~ 4     High 
## 2            2 Barclay Lynn French fries    Lunch on~ 5     Midd~
## 3            3 Jayendra Ly~ N/A             Breakfas~ 7     Low  
## 4            4 Leon Rossini Anchovies       Lunch on~ 99999 Midd~
## 5            5 Chidiegwu D~ Pizza           Breakfas~ five  High
```

---

## `clean_names()`

If the variable names are malformatted, use `janitor::clean_names()`


```r
library(janitor)
fav_food %&gt;% clean_names()  
```

```
## # A tibble: 5 x 6
##   student_id full_name   favourite_food   meal_plan   age   ses  
##        &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;
## 1          1 Sunil Huff~ Strawberry yogh~ Lunch only  4     High 
## 2          2 Barclay Ly~ French fries     Lunch only  5     Midd~
## 3          3 Jayendra L~ N/A              Breakfast ~ 7     Low  
## 4          4 Leon Rossi~ Anchovies        Lunch only  99999 Midd~
## 5          5 Chidiegwu ~ Pizza            Breakfast ~ five  High
```

---

## Case study: NYC Squirrels!

- [The Squirrel Census](https://www.thesquirrelcensus.com/) is a multimedia science, design, and storytelling project focusing on the Eastern gray (*Sciurus carolinensis*). They count squirrels and present their findings to the public.
- This table contains squirrel data for each of the 3,023 sightings, including location coordinates, age, primary and secondary fur color, elevation, activities, communications, and interactions between squirrels and with humans.


```r
#install_github("mine-cetinkaya-rundel/nycsquirrels18")
library(nycsquirrels18)
```

---

## Locate the codebook

[mine-cetinkaya-rundel.github.io/nycsquirrels18/reference/squirrels.html](https://mine-cetinkaya-rundel.github.io/nycsquirrels18/reference/squirrels.html)

&lt;br&gt;&lt;br&gt;

--

## Check the dimensions


```r
dim(squirrels)
```

```
## [1] 3023   35
```

---

## Look at the top...


```r
squirrels %&gt;% head()
```

```
## # A tibble: 6 x 35
##    long   lat unique_squirrel_id hectare shift date      
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;    
## 1 -74.0  40.8 13A-PM-1014-04     13A     PM    2018-10-14
## 2 -74.0  40.8 15F-PM-1010-06     15F     PM    2018-10-10
## 3 -74.0  40.8 19C-PM-1018-02     19C     PM    2018-10-18
## 4 -74.0  40.8 21B-AM-1019-04     21B     AM    2018-10-19
## 5 -74.0  40.8 23A-AM-1018-02     23A     AM    2018-10-18
## 6 -74.0  40.8 38H-PM-1012-01     38H     PM    2018-10-12
## # ... with 29 more variables: hectare_squirrel_number &lt;dbl&gt;,
## #   age &lt;chr&gt;, primary_fur_color &lt;chr&gt;,
## #   highlight_fur_color &lt;chr&gt;,
## #   combination_of_primary_and_highlight_color &lt;chr&gt;,
## #   color_notes &lt;chr&gt;, location &lt;chr&gt;,
## #   above_ground_sighter_measurement &lt;chr&gt;,
## #   specific_location &lt;chr&gt;, running &lt;lgl&gt;, chasing &lt;lgl&gt;, ...
```

---

## ...and the bottom

.small[

```r
squirrels %&gt;% tail()
```

```
## # A tibble: 6 x 35
##    long   lat unique_squirrel_id hectare shift date      
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;    
## 1 -74.0  40.8 6D-PM-1020-01      06D     PM    2018-10-20
## 2 -74.0  40.8 21H-PM-1018-01     21H     PM    2018-10-18
## 3 -74.0  40.8 31D-PM-1006-02     31D     PM    2018-10-06
## 4 -74.0  40.8 37B-AM-1018-04     37B     AM    2018-10-18
## 5 -74.0  40.8 21C-PM-1006-01     21C     PM    2018-10-06
## 6 -74.0  40.8 7G-PM-1018-04      07G     PM    2018-10-18
## # ... with 29 more variables: hectare_squirrel_number &lt;dbl&gt;,
## #   age &lt;chr&gt;, primary_fur_color &lt;chr&gt;,
## #   highlight_fur_color &lt;chr&gt;,
## #   combination_of_primary_and_highlight_color &lt;chr&gt;,
## #   color_notes &lt;chr&gt;, location &lt;chr&gt;,
## #   above_ground_sighter_measurement &lt;chr&gt;,
## #   specific_location &lt;chr&gt;, running &lt;lgl&gt;, chasing &lt;lgl&gt;, ...
```
]

---

## Validate with at least one external data source

.pull-left[

```
## # A tibble: 3,023 x 2
##     long   lat
##    &lt;dbl&gt; &lt;dbl&gt;
##  1 -74.0  40.8
##  2 -74.0  40.8
##  3 -74.0  40.8
##  4 -74.0  40.8
##  5 -74.0  40.8
##  6 -74.0  40.8
##  7 -74.0  40.8
##  8 -74.0  40.8
##  9 -74.0  40.8
## 10 -74.0  40.8
## 11 -74.0  40.8
## 12 -74.0  40.8
## 13 -74.0  40.8
## 14 -74.0  40.8
## 15 -74.0  40.8
## # ... with 3,008 more rows
```
]
.pull-right[
&lt;img src="img/central-park-coords.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Make a plot


```r
ggplot(squirrels, aes(x = long, y = lat)) +
  geom_point(alpha = 0.2)
```

&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-79-1.png" width="45%" style="display: block; margin: auto;" /&gt;

--

.pull-left-wide[
**Hypothesis:** There will be a higher density of sightings on the perimeter than inside the park.
]

---

## Try the easy solution first

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-80-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
squirrels &lt;- squirrels %&gt;%
  separate(hectare, into = c("NS", "EW"), sep = 2, remove = FALSE) %&gt;%
  mutate(where = if_else(NS %in% c("01", "42") | EW %in% c("A", "I"), "perimeter", "inside")) 

ggplot(squirrels, aes(x = long, y = lat, color = where)) +
  geom_point(alpha = 0.2)
```
]

]

---

## Then go deeper...

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo04-u2-14-15-16-17_files/figure-html/unnamed-chunk-81-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
hectare_counts &lt;- squirrels %&gt;%
  group_by(hectare) %&gt;%
  summarise(n = n()) 

hectare_centroids &lt;- squirrels %&gt;%
  group_by(hectare) %&gt;%
  summarise(
    centroid_x = mean(long),
    centroid_y = mean(lat)
  )

squirrels %&gt;%
  left_join(hectare_counts, by = "hectare") %&gt;%
  left_join(hectare_centroids, by = "hectare") %&gt;%
  ggplot(aes(x = centroid_x, y = centroid_y, color = n)) +
  geom_hex()
```
]

]

---

## The squirrel is staring at me!


```r
squirrels %&gt;%
  filter(str_detect(other_interactions, "star")) %&gt;%
  select(shift, age, other_interactions)
```

```
## # A tibble: 11 x 3
##   shift age   other_interactions                                 
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                                              
## 1 AM    Adult staring at us                                      
## 2 PM    Adult he took 2 steps then turned and stared at me       
## 3 PM    Adult stared                                             
## 4 PM    Adult stared                                             
## 5 PM    Adult stared                                             
## 6 PM    Adult stared &amp; then went back up treeâ€”then ran to differ~
## # ... with 5 more rows
```

---

## Communicating for your audience

- Avoid: Jargon, uninterpreted results, lengthy output
- Pay attention to: Organization, presentation, flow
- Don't forget about: Code style, coding best practices, meaningful commits
- Be open to: Suggestions, feedback, taking (calculated) risks
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
