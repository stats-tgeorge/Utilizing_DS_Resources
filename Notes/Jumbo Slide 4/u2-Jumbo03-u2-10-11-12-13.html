<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data types</title>
    <meta charset="utf-8" />
    <meta name="author" content="datasciencebox.org Modified by Tyler George" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <script src="libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="../xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="../slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data types
## <br><br> Data Science in a Box
### <a href="https://datasciencebox.org/">datasciencebox.org</a><br />
Modified by Tyler George

---





layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://datasciencebox.org" target="_blank"&gt;datasciencebox.org&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---



class: middle

# Why should you care about data types?

---

## Example: Cat lovers

A survey asked respondents their name and number of cats. The instructions said to enter the number of cats as a numerical value.


```r
cat_lovers &lt;- read_csv("data/cat-lovers.csv")
```


```
## # A tibble: 60 x 3
##   name           number_of_cats handedness
##   &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;     
## 1 Bernice Warren 0              left      
## 2 Woodrow Stone  0              left      
## 3 Willie Bass    1              left      
## 4 Tyrone Estrada 3              left      
## 5 Alex Daniels   3              left      
## 6 Jane Bates     2              left      
## # ... with 54 more rows
```

---

## Oh why won't you work?!


```r
cat_lovers %&gt;%
  summarise(mean_cats = mean(number_of_cats))
```

```
## Warning in mean.default(number_of_cats): argument is not numeric
## or logical: returning NA
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1        NA
```

---


```r
?mean
```

&lt;img src="img/mean-help.png" width="75%" style="display: block; margin: auto;" /&gt;

---

## Oh why won't you still work??!!


```r
cat_lovers %&gt;%
  summarise(mean_cats = mean(number_of_cats, na.rm = TRUE))
```

```
## Warning in mean.default(number_of_cats, na.rm = TRUE): argument
## is not numeric or logical: returning NA
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1        NA
```

---

## Take a breath and look at your data

.question[
What is the type of the `number_of_cats` variable?
]


```r
glimpse(cat_lovers)
```

```
## Rows: 60
## Columns: 3
## $ name           &lt;chr&gt; "Bernice Warren", "Woodrow Stone", "Will~
## $ number_of_cats &lt;chr&gt; "0", "0", "1", "3", "3", "2", "1", "1", ~
## $ handedness     &lt;chr&gt; "left", "left", "left", "left", "left", ~
```

---

## Let's take another look

.small[
<div id="htmlwidget-8f836166d559454ecd73" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8f836166d559454ecd73">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],["Bernice Warren","Woodrow Stone","Willie Bass","Tyrone Estrada","Alex Daniels","Jane Bates","Latoya Simpson","Darin Woods","Agnes Cobb","Tabitha Grant","Perry Cross","Wanda Silva","Alicia Sims","Emily Logan","Woodrow Elliott","Brent Copeland","Pedro Carlson","Patsy Luna","Brett Robbins","Oliver George","Calvin Perry","Lora Gutierrez","Charlotte Sparks","Earl Mack","Leslie Wade","Santiago Barker","Jose Bell","Lynda Smith","Bradford Marshall","Irving Miller","Caroline Simpson","Frances Welch","Melba Jenkins","Veronica Morales","Juanita Cunningham","Maurice Howard","Teri Pierce","Phil Franklin","Jan Zimmerman","Leslie Price","Bessie Patterson","Ethel Wolfe","Naomi Wright","Sadie Frank","Lonnie Cannon","Tony Garcia","Darla Newton","Ginger Clark","Lionel Campbell","Florence Klein","Harriet Leonard","Terrence Harrington","Travis Garner","Doug Bass","Pat Norris","Dawn Young","Shari Alvarez","Tamara Robinson","Megan Morgan","Kara Obrien"],["0","0","1","3","3","2","1","1","0","0","0","0","1","3","3","2","1","1","0","0","1","1","0","0","4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","1","3","3","2","1","1.5 - honestly I think one of my cats is half human","0","0","1","0","1","three","1","1","1","0","0","2"],["left","left","left","left","left","left","left","left","left","left","left","left","left","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","ambidextrous","ambidextrous","ambidextrous","ambidextrous","ambidextrous"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>number_of_cats<\/th>\n      <th>handedness<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
]

---

## Sometimes you might need to babysit your respondents

.midi[

```r
cat_lovers %&gt;%
  mutate(number_of_cats = case_when(
    name == "Ginger Clark" ~ 2,
    name == "Doug Bass"    ~ 3,
    TRUE                   ~ as.numeric(number_of_cats)
    )) %&gt;%
  summarise(mean_cats = mean(number_of_cats))
```

```
## Warning in eval_tidy(pair$rhs, env = default_env): NAs introduced
## by coercion
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.833
```
]

---

## Always you need to respect data types


```r
cat_lovers %&gt;%
  mutate(
    number_of_cats = case_when(
      name == "Ginger Clark" ~ "2",
      name == "Doug Bass"    ~ "3",
      TRUE                   ~ number_of_cats
      ),
    number_of_cats = as.numeric(number_of_cats)
    ) %&gt;%
  summarise(mean_cats = mean(number_of_cats))
```

```
## # A tibble: 1 x 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.833
```

---

## Now that we know what we're doing...


```r
*cat_lovers &lt;- cat_lovers %&gt;%
  mutate(
    number_of_cats = case_when(
      name == "Ginger Clark" ~ "2",
      name == "Doug Bass"    ~ "3",
      TRUE                   ~ number_of_cats
      ),
    number_of_cats = as.numeric(number_of_cats)
    )
```

---

## Moral of the story

- If your data does not behave how you expect it to, type coercion upon reading in the data might be the reason.
- Go in and investigate your data, apply the fix, *save your data*, live happily ever after.

---

class: middle

.hand[.light-blue[now that we have a good motivation for]]  
.hand[.light-blue[learning about data types in R]]

&lt;br&gt;

.large[
.hand[.light-blue[let's learn about data types in R!]]
]

---

class: middle

# Data types

---

## Data types in R

- **logical**
- **double**
- **integer**
- **character**
- and some more, but we won't be focusing on those

---

## Logical &amp; character

.pull-left[
**logical** - boolean values `TRUE` and `FALSE`


```r
typeof(TRUE)
```

```
## [1] "logical"
```
]
.pull-right[
**character** - character strings


```r
typeof("hello")
```

```
## [1] "character"
```
]

---

## Double &amp; integer

.pull-left[
**double** - floating point numerical values (default numerical type)


```r
typeof(1.335)
```

```
## [1] "double"
```

```r
typeof(7)
```

```
## [1] "double"
```
]
.pull-right[
**integer** - integer numerical values (indicated with an `L`)


```r
typeof(7L)
```

```
## [1] "integer"
```

```r
typeof(1:3)
```

```
## [1] "integer"
```
]

---

## Concatenation

Vectors can be constructed using the `c()` function.


```r
c(1, 2, 3)
```

```
## [1] 1 2 3
```

```r
c("Hello", "World!")
```

```
## [1] "Hello"  "World!"
```

```r
c(c("hi", "hello"), c("bye", "jello"))
```

```
## [1] "hi"    "hello" "bye"   "jello"
```

---

## Converting between types

.hand[with intention...]

.pull-left[

```r
x &lt;- 1:3
x
```

```
## [1] 1 2 3
```

```r
typeof(x)
```

```
## [1] "integer"
```
]
--
.pull-right[

```r
y &lt;- as.character(x)
y
```

```
## [1] "1" "2" "3"
```

```r
typeof(y)
```

```
## [1] "character"
```
]

---

## Converting between types

.hand[with intention...]

.pull-left[

```r
x &lt;- c(TRUE, FALSE)
x
```

```
## [1]  TRUE FALSE
```

```r
typeof(x)
```

```
## [1] "logical"
```
]
--
.pull-right[

```r
y &lt;- as.numeric(x)
y
```

```
## [1] 1 0
```

```r
typeof(y)
```

```
## [1] "double"
```
]

---

## Converting between types

.hand[without intention...]

R will happily convert between various types without complaint when different types of data are concatenated in a vector, and that's not always a great thing!

.pull-left[

```r
c(1, "Hello")
```

```
## [1] "1"     "Hello"
```

```r
c(FALSE, 3L)
```

```
## [1] 0 3
```
]
--
.pull-right[

```r
c(1.2, 3L)
```

```
## [1] 1.2 3.0
```

```r
c(2L, "two")
```

```
## [1] "2"   "two"
```
]

---

## Explicit vs. implicit coercion

Let's give formal names to what we've seen so far:

--
- **Explicit coercion** is when you call a function like `as.logical()`, `as.numeric()`, `as.integer()`, `as.double()`, or `as.character()`


--
- **Implicit coercion** happens when you use a vector in a specific context that expects a certain type of vector

---

.midi[
.your-turn[
### .hand[Your turn!]

- RStudio  &gt; `AE 05 - Hotels + Data types` &gt; open `type-coercion.Rmd` and knit.
- What is the type of the given vectors? First, guess. Then, try it out in R. 
If your guess was correct, great! If not, discuss why they have that type.
]
]

--

.small[
**Example:** Suppose we want to know the type of `c(1, "a")`. First, I'd look at: 

.pull-left[

```r
typeof(1)
```

```
## [1] "double"
```
]
.pull-right[

```r
typeof("a")
```

```
## [1] "character"
```
]

and make a guess based on these. Then finally I'd check:
.pull-left[

```r
typeof(c(1, "a"))
```

```
## [1] "character"
```
]
]

---

class: middle

# Special values

---

## Special values

- `NA`: Not available
- `NaN`: Not a number
- `Inf`: Positive infinity
- `-Inf`: Negative infinity

--

.pull-left[

```r
pi / 0
```

```
## [1] Inf
```

```r
0 / 0
```

```
## [1] NaN
```
]
.pull-right[

```r
1/0 - 1/0
```

```
## [1] NaN
```

```r
1/0 + 1/0
```

```
## [1] Inf
```
]

---

## `NA`s are special ❄️s


```r
x &lt;- c(1, 2, 3, 4, NA)
```


```r
mean(x)
```

```
## [1] NA
```

```r
mean(x, na.rm = TRUE)
```

```
## [1] 2.5
```

```r
summary(x)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    1.00    1.75    2.50    2.50    3.25    4.00       1
```

---

## `NA`s are logical

R uses `NA` to represent missing values in its data structures.


```r
typeof(NA)
```

```
## [1] "logical"
```

---

## Mental model for `NA`s

- Unlike `NaN`, `NA`s are genuinely unknown values
- But that doesn't mean they can't function in a logical way
- Let's think about why `NA`s are logical...

--

.question[
Why do the following give different answers?
]
.pull-left[

```r
# TRUE or NA
TRUE | NA
```

```
## [1] TRUE
```
]
.pull-right[

```r
# FALSE or NA
FALSE | NA
```

```
## [1] NA
```
]

`\(\rightarrow\)` See next slide for answers...

---

- `NA` is unknown, so it could be `TRUE` or `FALSE`

.pull-left[
.midi[
- `TRUE | NA`

```r
TRUE | TRUE  # if NA was TRUE
```

```
## [1] TRUE
```

```r
TRUE | FALSE # if NA was FALSE
```

```
## [1] TRUE
```
]
]
.pull-right[
.midi[
- `FALSE | NA`

```r
FALSE | TRUE  # if NA was TRUE
```

```
## [1] TRUE
```

```r
FALSE | FALSE # if NA was FALSE
```

```
## [1] FALSE
```
]
]

- Doesn't make sense for mathematical operations 
- Makes sense in the context of missing data


---

class: middle

# Data classes

---

## Data classes

We talked about *types* so far, next we'll introduce the concept of *classes*

- Vectors are like Lego building blocks

--
- We stick them together to build more complicated constructs, e.g. *representations of data*

--
- The **class** attribute relates to the S3 class of an object which determines its behaviour
  - You don't need to worry about what S3 classes really mean, but you can read more about it [here](https://adv-r.hadley.nz/s3.html#s3-classes) if you're curious

--
- Examples: factors, dates, and data frames
  
---

## Factors

R uses factors to handle categorical variables, variables that have a fixed and known set of possible values


```r
x &lt;- factor(c("BS", "MS", "PhD", "MS"))
x
```

```
## [1] BS  MS  PhD MS 
## Levels: BS MS PhD
```

--

.pull-left[

```r
typeof(x)
```

```
## [1] "integer"
```
]
.pull-right[

```r
class(x)
```

```
## [1] "factor"
```
]


---

## More on factors

We can think of factors like character (level labels) and an integer (level numbers) glued together


```r
glimpse(x)
```

```
##  Factor w/ 3 levels "BS","MS","PhD": 1 2 3 2
```

```r
as.integer(x)
```

```
## [1] 1 2 3 2
```

---

## Dates


```r
y &lt;- as.Date("2020-01-01")
y
```

```
## [1] "2020-01-01"
```

```r
typeof(y)
```

```
## [1] "double"
```

```r
class(y)
```

```
## [1] "Date"
```

---

## More on dates

We can think of dates like an integer (the number of days since the origin, 1 Jan 1970) and an integer (the origin) glued together


```r
as.integer(y)
```

```
## [1] 18262
```

```r
as.integer(y) / 365 # roughly 50 yrs
```

```
## [1] 50.03288
```

---

## Data frames

We can think of data frames like like vectors of equal length glued together


```r
df &lt;- data.frame(x = 1:2, y = 3:4)
df
```

```
##   x y
## 1 1 3
## 2 2 4
```

.pull-left[

```r
typeof(df)
```

```
## [1] "list"
```
]
.pull-right[

```r
class(df)
```

```
## [1] "data.frame"
```
]

---

## Lists

Lists are a generic vector container vectors of any type can go in them


```r
l &lt;- list(
  x = 1:4,
  y = c("hi", "hello", "jello"),
  z = c(TRUE, FALSE)
)
l
```

```
## $x
## [1] 1 2 3 4
## 
## $y
## [1] "hi"    "hello" "jello"
## 
## $z
## [1]  TRUE FALSE
```

---

## Lists and data frames

- A data frame is a special list containing vectors of equal length
- When we use the `pull()` function, we extract a vector from the data frame


```r
df
```

```
##   x y
## 1 1 3
## 2 2 4
```

```r
df %&gt;%
  pull(y)
```

```
## [1] 3 4
```


---

class: middle

# Working with factors

---



## Read data in as character strings


```r
glimpse(cat_lovers)
```

```
## Rows: 60
## Columns: 3
## $ name           &lt;chr&gt; "Bernice Warren", "Woodrow Stone", "Will~
## $ number_of_cats &lt;chr&gt; "0", "0", "1", "3", "3", "2", "1", "1", ~
## $ handedness     &lt;chr&gt; "left", "left", "left", "left", "left", ~
```

---

## But coerce when plotting


```r
ggplot(cat_lovers, mapping = aes(x = handedness)) +
  geom_bar()
```

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-49-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Use forcats to manipulate factors


```r
cat_lovers %&gt;%
* mutate(handedness = fct_infreq(handedness)) %&gt;%
  ggplot(mapping = aes(x = handedness)) +
  geom_bar()
```

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-50-1.png" width="55%" style="display: block; margin: auto;" /&gt;

---

## Come for the functionality

.pull-left[
... stay for the logo
]
.pull-right[
&lt;img src="img/forcats-part-of-tidyverse.png" width="70%" style="display: block; margin: auto;" /&gt;
]

.pull-left-wide[
- Factors are useful when you have true categorical data and you want to override the ordering of character vectors to improve display
- They are also useful in modeling scenarios
- The **forcats** package provides a suite of useful tools that solve common problems with factors
]

---

.small[
.your-turn[
### .hand[Your turn!]

- [RStudio ](http://rstd.io/dsbox-) &gt; `AE 05 - Hotels + Data types` &gt; `hotels-forcats.Rmd` &gt; knit
- Recreate the x-axis of the following plot. 
- **Stertch goal:** Recreate the y-axis.
]
]

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-52-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

class: middle

# Working with dates

---

## Make a date

.pull-left[
&lt;img src="img/lubridate-not-part-of-tidyverse.png" width="65%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
- **lubridate** is the tidyverse-friendly package that makes dealing with dates a little easier
- It's not one of the *core* tidyverse packages, hence it's installed with `install.packages("tidyverse)` but it's not loaded with it, and needs to be explicitly loaded with `library(lubridate)`
]

---

class: middle

.hand[.light-blue[
we're just going to scratch the surface of working with dates in R here...
]]

---

.question[
Calculate and visualise the number of bookings on any given arrival date.
]


```r
hotels %&gt;%
  select(starts_with("arrival_"))
```

```
## # A tibble: 119,390 x 4
##   arrival_date_year arrival_date_month arrival_date_week_number
##               &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
## 1              2015 July                                     27
## 2              2015 July                                     27
## 3              2015 July                                     27
## 4              2015 July                                     27
## 5              2015 July                                     27
## 6              2015 July                                     27
## # ... with 119,384 more rows, and 1 more variable:
## #   arrival_date_day_of_month &lt;dbl&gt;
```

---

## Step 1. Construct dates

.midi[

```r
library(glue)

hotels %&gt;%
  mutate(
*   arrival_date = glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}")
    ) %&gt;% 
  relocate(arrival_date)
```

```
## # A tibble: 119,390 x 33
##   arrival_date hotel       is_canceled lead_time arrival_date_ye~
##   &lt;glue&gt;       &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;            &lt;dbl&gt;
## 1 2015 July 1  Resort Hot~           0       342             2015
## 2 2015 July 1  Resort Hot~           0       737             2015
## 3 2015 July 1  Resort Hot~           0         7             2015
## 4 2015 July 1  Resort Hot~           0        13             2015
...
```
]

---

## Step 2. Count bookings per date

.midi[

```r
hotels %&gt;%
  mutate(arrival_date = glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}")) %&gt;%
  count(arrival_date)
```

```
## # A tibble: 793 x 2
##   arrival_date       n
##   &lt;glue&gt;         &lt;int&gt;
## 1 2015 August 1    110
## 2 2015 August 10   207
## 3 2015 August 11   117
## 4 2015 August 12   133
## 5 2015 August 13   107
## 6 2015 August 14   329
## # ... with 787 more rows
```
]

---

## Step 3. Visualise bookings per date

.midi[

```r
hotels %&gt;%
  mutate(arrival_date = glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}")) %&gt;%
  count(arrival_date) %&gt;%
  ggplot(aes(x = arrival_date, y = n, group = 1)) +
  geom_line()
```

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-57-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

.hand[zooming in a bit...]

.question[
Why does the plot start with August when we know our data start in July? And why does 10 August come after 1 August?
]

.midi[
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-58-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Step 1. *REVISED* Construct dates "as dates"

.midi[

```r
library(lubridate)

hotels %&gt;%
  mutate(
*   arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))
    ) %&gt;% 
  relocate(arrival_date)
```

```
## # A tibble: 119,390 x 33
##   arrival_date hotel       is_canceled lead_time arrival_date_ye~
##   &lt;date&gt;       &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;            &lt;dbl&gt;
## 1 2015-07-01   Resort Hot~           0       342             2015
## 2 2015-07-01   Resort Hot~           0       737             2015
## 3 2015-07-01   Resort Hot~           0         7             2015
## 4 2015-07-01   Resort Hot~           0        13             2015
...
```
]

---

## Step 2. Count bookings per date

.midi[

```r
hotels %&gt;%
  mutate(arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))) %&gt;% 
  count(arrival_date)
```

```
## # A tibble: 793 x 2
##   arrival_date     n
##   &lt;date&gt;       &lt;int&gt;
## 1 2015-07-01     122
## 2 2015-07-02      93
## 3 2015-07-03      56
## 4 2015-07-04      88
## 5 2015-07-05      53
## 6 2015-07-06      75
## # ... with 787 more rows
```
]

---

## Step 3a. Visualise bookings per date

.midi[

```r
hotels %&gt;%
  mutate(arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))) %&gt;% 
  count(arrival_date) %&gt;%
  ggplot(aes(x = arrival_date, y = n, group = 1)) +
  geom_line()
```

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-61-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Step 3b. Visualise using a smooth curve

.midi[

```r
hotels %&gt;%
  mutate(arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))) %&gt;% 
  count(arrival_date) %&gt;%
  ggplot(aes(x = arrival_date, y = n, group = 1)) +
* geom_smooth()
```

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-62-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]


---

class: middle

# Reading rectangular data into R

---

class: middle

.pull-left[
&lt;img src="img/readr.png" width="80%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="img/readxl.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

.pull-left[
## readr

- `read_csv()` - comma delimited files
- `read_csv2()` - semicolon separated files (common in countries where , is used as the decimal place)
- `read_tsv()` - tab delimited files
- `read_delim()` - reads in files with any delimiter
- `read_fwf()` - fixed width files
- ...
]

--
.pull-right[
## readxl

- `read_excel()` - read xls or xlsx files
- ...
]

---

## Reading data


```r
nobel &lt;- read_csv(file = "data/nobel.csv")
nobel
```

```
## # A tibble: 935 x 26
##      id firstname      surname    year category affiliation city 
##   &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;
## 1     1 Wilhelm Conrad Röntgen    1901 Physics  Munich Uni~ Muni~
## 2     2 Hendrik A.     Lorentz    1902 Physics  Leiden Uni~ Leid~
## 3     3 Pieter         Zeeman     1902 Physics  Amsterdam ~ Amst~
## 4     4 Henri          Becquerel  1903 Physics  École Poly~ Paris
## 5     5 Pierre         Curie      1903 Physics  École muni~ Paris
## 6     6 Marie          Curie      1903 Physics  &lt;NA&gt;        &lt;NA&gt; 
## # ... with 929 more rows, and 19 more variables: country &lt;chr&gt;,
## #   born_date &lt;date&gt;, died_date &lt;date&gt;, gender &lt;chr&gt;,
## #   born_city &lt;chr&gt;, born_country &lt;chr&gt;,
## #   born_country_code &lt;chr&gt;, died_city &lt;chr&gt;,
## #   died_country &lt;chr&gt;, died_country_code &lt;chr&gt;,
## #   overall_motivation &lt;chr&gt;, share &lt;dbl&gt;, motivation &lt;chr&gt;,
## #   born_country_original &lt;chr&gt;, born_city_original &lt;chr&gt;, ...
```

---

## Writing data

.pull-left[
- Write a file


```r
df &lt;- tribble(
  ~x, ~y,
  1,  "a",
  2,  "b",
  3,  "c"
)

write_csv(df, file = "data/df.csv")
```
]

--
.pull-right[
- Read it back in to inspect


```r
read_csv("data/df.csv")
```

```
## # A tibble: 3 x 2
##       x y    
##   &lt;dbl&gt; &lt;chr&gt;
## 1     1 a    
## 2     2 b    
## 3     3 c
```
]

---

.your-turn[
### .hand[Your turn!]

- RStudio  &gt; `AE 06 - Nobels and sales + Data import` &gt; open `nobels-csv.Rmd` and knit.
- Read in the `nobels.csv` file from the `data-raw/` folder.
- Split into two (STEM and non-STEM): 
  - Create a new data frame, `nobel_stem`, that filters for the STEM fields 
(Physics, Medicine, Chemistry, and Economics).
  - Create another data frame, `nobel_nonstem`, that filters for the remaining 
fields.  
- Write out the two data frames to `nobel-stem.csv` and `nobel-nonstem.csv`, 
respectively, to `data/`.

**Hint:** Use the `%in%` operator when `filter()`ing.
]

---

class: middle

# Variable names

---

## Data with bad names


```r
edibnb_badnames &lt;- read_csv("data/edibnb-badnames.csv")
names(edibnb_badnames)
```

```
##  [1] "ID"                   "Price"               
##  [3] "neighbourhood"        "accommodates"        
##  [5] "Number of bathrooms"  "Number of Bedrooms"  
##  [7] "n beds"               "Review Scores Rating"
##  [9] "Number of reviews"    "listing_url"
```

--

... but R doesn't allow spaces in variable names


```r
ggplot(edibnb_badnames, aes(x = Number of bathrooms, y = Price)) +
  geom_point()
```

```
## Error: &lt;text&gt;:1:40: unexpected symbol
## 1: ggplot(edibnb_badnames, aes(x = Number of
##                                            ^
```

---

## Option 1 - Define column names

.small[

```r
edibnb_col_names &lt;- read_csv("data/edibnb-badnames.csv",
                             col_names = c("id", "price", 
                                           "neighbourhood", "accommodates",
                                           "bathroom", "bedroom", 
                                           "bed", "review_scores_rating", 
                                           "n_reviews", "url"))

names(edibnb_col_names)
```

```
##  [1] "id"                   "price"               
##  [3] "neighbourhood"        "accommodates"        
##  [5] "bathroom"             "bedroom"             
##  [7] "bed"                  "review_scores_rating"
##  [9] "n_reviews"            "url"
```
]

---

## Option 2 - Format text to snake_case


```r
edibnb_clean_names &lt;- read_csv("data/edibnb-badnames.csv") %&gt;%
  janitor::clean_names()

names(edibnb_clean_names)
```

```
##  [1] "id"                   "price"               
##  [3] "neighbourhood"        "accommodates"        
##  [5] "number_of_bathrooms"  "number_of_bedrooms"  
##  [7] "n_beds"               "review_scores_rating"
##  [9] "number_of_reviews"    "listing_url"
```

---

class: middle

# Variable types

---

.question[
Which type is `x`? Why?
]

.pull-left[
&lt;img src="img/df-na.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
read_csv("data/df-na.csv")
```


```
## # A tibble: 9 x 3
##   x     y              z     
##   &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt; 
## 1 1     a              hi    
## 2 &lt;NA&gt;  b              hello 
## 3 3     Not applicable 9999  
## 4 4     d              ola   
## 5 5     e              hola  
## 6 .     f              whatup
## 7 7     g              wassup
## 8 8     h              sup   
## 9 9     i              &lt;NA&gt;
```
]

---

## Option 1. Explicit NAs


```r
read_csv("data/df-na.csv", 
         na = c("", "NA", ".", "9999", "Not applicable"))
```

.pull-left[
&lt;img src="img/df-na.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```
## # A tibble: 9 x 3
##       x y     z     
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1     1 a     hi    
## 2    NA b     hello 
## 3     3 &lt;NA&gt;  &lt;NA&gt;  
## 4     4 d     ola   
## 5     5 e     hola  
## 6    NA f     whatup
## 7     7 g     wassup
## 8     8 h     sup   
## 9     9 i     &lt;NA&gt;
```
]

---

## Option 2. Specify column types


```r
read_csv("data/df-na.csv", col_types = list(col_double(), 
                                            col_character(), 
                                            col_character()))
```


```
## Warning: One or more parsing issues, see `problems()` for details
```

```
## # A tibble: 9 x 3
##       x y              z     
##   &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; 
## 1     1 a              hi    
## 2    NA b              hello 
## 3     3 Not applicable 9999  
## 4     4 d              ola   
## 5     5 e              hola  
## 6    NA f              whatup
## 7     7 g              wassup
## 8     8 h              sup   
## 9     9 i              &lt;NA&gt;
```

---

## Column types

.small[
**type function**  | **data type**
------------------ | -------------
`col_character()`  | character
`col_date()`       | date
`col_datetime()`   | POSIXct (date-time)
`col_double()`     | double (numeric)
`col_factor()`     | factor
`col_guess()`      | let readr guess (default)
`col_integer()`    | integer
`col_logical()`    | logical
`col_number()`     | numbers mixed with non-number characters
`col_numeric()`    | double or integer
`col_skip()`       | do not read
`col_time()`       | time
]

---

.question[
Wondering where you remember these from?
]


```r
read_csv("data/df-na.csv")
```

```
## 
                                                                  
Rows: 9 Columns: 3
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...
```

```
## 
                                                                  
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...

                                                                  
-- Column specification -----------------------------------------
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...

                                                                  
Delimiter: ","
## chr (3): x, y, z
## 
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...
```

```
## 
                                                                  
## 
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...

                                                                  
i Use `spec()` to retrieve the full column specification for this data.
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...

                                                                  
i Specify the column types or set `show_col_types = FALSE` to quiet this message.
## [36mi[39m Building [34mu2-Jumbo03-u2-10-11-12-13.rmd[39m into [32mu2-Jumbo03-u2-10[39m...
```

```
## # A tibble: 9 x 3
##   x     y              z     
##   &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt; 
## 1 1     a              hi    
## 2 &lt;NA&gt;  b              hello 
## 3 3     Not applicable 9999  
## 4 4     d              ola   
...
```

---

class:middle

# Case study: Favourite foods

---

## Favourite foods

&lt;img src="img/fav-food/fav-food.png" width="60%" style="display: block; margin: auto;" /&gt;

--


```r
*fav_food &lt;- read_excel("data/favourite-food.xlsx")

fav_food
```

```
## # A tibble: 5 x 6
##   `Student ID` `Full Name`  favourite.food  mealPlan  AGE   SES  
##          &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;
## 1            1 Sunil Huffm~ Strawberry yog~ Lunch on~ 4     High 
## 2            2 Barclay Lynn French fries    Lunch on~ 5     Midd~
## 3            3 Jayendra Ly~ N/A             Breakfas~ 7     Low  
## 4            4 Leon Rossini Anchovies       Lunch on~ 99999 Midd~
## 5            5 Chidiegwu D~ Pizza           Breakfas~ five  High
```

---

## Variable names

&lt;img src="img/fav-food/fav-food-names.png" width="60%" style="display: block; margin: auto;" /&gt;

--


```r
fav_food &lt;- read_excel("data/favourite-food.xlsx") %&gt;%
* janitor::clean_names()

fav_food 
```

```
## # A tibble: 5 x 6
##   student_id full_name   favourite_food   meal_plan   age   ses  
##        &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;
## 1          1 Sunil Huff~ Strawberry yogh~ Lunch only  4     High 
## 2          2 Barclay Ly~ French fries     Lunch only  5     Midd~
## 3          3 Jayendra L~ N/A              Breakfast ~ 7     Low  
## 4          4 Leon Rossi~ Anchovies        Lunch only  99999 Midd~
## 5          5 Chidiegwu ~ Pizza            Breakfast ~ five  High
```

---

## Handling NAs

&lt;img src="img/fav-food/fav-food-nas.png" width="60%" style="display: block; margin: auto;" /&gt;

--


```r
fav_food &lt;- read_excel("data/favourite-food.xlsx",
*                      na = c("N/A", "99999")) %&gt;%
  janitor::clean_names()

fav_food 
```

```
## # A tibble: 5 x 6
##   student_id full_name   favourite_food   meal_plan   age   ses  
##        &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;
## 1          1 Sunil Huff~ Strawberry yogh~ Lunch only  4     High 
## 2          2 Barclay Ly~ French fries     Lunch only  5     Midd~
## 3          3 Jayendra L~ &lt;NA&gt;             Breakfast ~ 7     Low  
## 4          4 Leon Rossi~ Anchovies        Lunch only  &lt;NA&gt;  Midd~
## 5          5 Chidiegwu ~ Pizza            Breakfast ~ five  High
```

---

## Make `age` numeric

.pull-left-wide[

```r
fav_food &lt;- fav_food %&gt;%
* mutate(
*   age = if_else(age == "five", "5", age),
*   age = as.numeric(age)
*   )

glimpse(fav_food) 
```

```
## Rows: 5
## Columns: 6
## $ student_id     &lt;dbl&gt; 1, 2, 3, 4, 5
## $ full_name      &lt;chr&gt; "Sunil Huffmann", "Barclay Lynn", "Jayen~
## $ favourite_food &lt;chr&gt; "Strawberry yoghurt", "French fries", NA~
## $ meal_plan      &lt;chr&gt; "Lunch only", "Lunch only", "Breakfast a~
## $ age            &lt;dbl&gt; 4, 5, 7, NA, 5
## $ ses            &lt;chr&gt; "High", "Middle", "Low", "Middle", "High"
```
]
.pull-right-narrow[
&lt;img src="img/fav-food/fav-food-age.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---

## Socio-economic status

.question[
What order are the levels of `ses` listed in?
]

.pull-left-wide[

```r
fav_food %&gt;%
  count(ses)
```

```
## # A tibble: 3 x 2
##   ses        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 High       2
## 2 Low        1
## 3 Middle     2
```
]
.pull-right-narrow[
&lt;img src="img/fav-food/fav-food-ses.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---

## Make `ses` factor

.pull-left-wide[

```r
fav_food &lt;- fav_food %&gt;%
* mutate(ses = fct_relevel(ses, "Low", "Middle", "High"))

fav_food %&gt;%
  count(ses)
```

```
## # A tibble: 3 x 2
##   ses        n
##   &lt;fct&gt;  &lt;int&gt;
## 1 Low        1
## 2 Middle     2
## 3 High       2
```
]

---

## Putting it altogether


```r
fav_food &lt;- read_excel("data/favourite-food.xlsx", na = c("N/A", "99999")) %&gt;%
  janitor::clean_names() %&gt;%
  mutate(
    age = if_else(age == "five", "5", age), 
    age = as.numeric(age),
    ses = fct_relevel(ses, "Low", "Middle", "High")
  )

fav_food
```

```
## # A tibble: 5 x 6
##   student_id full_name   favourite_food   meal_plan     age ses  
##        &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;            &lt;chr&gt;       &lt;dbl&gt; &lt;fct&gt;
## 1          1 Sunil Huff~ Strawberry yogh~ Lunch only      4 High 
## 2          2 Barclay Ly~ French fries     Lunch only      5 Midd~
## 3          3 Jayendra L~ &lt;NA&gt;             Breakfast ~     7 Low  
## 4          4 Leon Rossi~ Anchovies        Lunch only     NA Midd~
## 5          5 Chidiegwu ~ Pizza            Breakfast ~     5 High
```

---

## Out and back in


```r
write_csv(fav_food, file = "data/fav-food-clean.csv")

fav_food_clean &lt;- read_csv("data/fav-food-clean.csv")
```

---

.question[
What happened to `ses` again?
]


```r
fav_food_clean %&gt;%
  count(ses)
```

```
## # A tibble: 3 x 2
##   ses        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 High       2
## 2 Low        1
## 3 Middle     2
```

---

## `read_rds()` and `write_rds()`

- CSVs can be unreliable for saving interim results if there is specific variable type information you want to hold on to.
- An alternative is RDS files, you can read and write them with `read_rds()` and `write_rds()`, respectively.


```r
read_rds(path)
write_rds(x, path)
```

---

## Out and back in, take 2


```r
write_rds(fav_food, file = "data/fav-food-clean.rds")

fav_food_clean &lt;- read_rds("data/fav-food-clean.rds")

fav_food_clean %&gt;%
  count(ses)
```

```
## # A tibble: 3 x 2
##   ses        n
##   &lt;fct&gt;  &lt;int&gt;
## 1 Low        1
## 2 Middle     2
## 3 High       2
```

---

class: middle

# Other types of data

---

## Other types of data

- **googlesheets4:** Google Sheets
- **haven**: SPSS, Stata, and SAS files
- **DBI**, along with a database specific backend (e.g. RMySQL, RSQLite, RPostgreSQL etc): allows you to run SQL queries against a database and return a data frame
- **jsonline**: JSON
- **xml2**: xml
- **rvest**: web scraping
- **httr**: web APIs
- **sparklyr**: data loaded into spark

---

.your-turn[
### .hand[Your turn!]
.midi[
- RStudio  &gt; `AE 06 - Nobels and sales + Data import` &gt; `sales-excel.Rmd`. 
- Load the `sales.xlsx` file from the `data-raw/` folder, using appropriate arguments for the `read_excel()` function such that it looks like the output on the left.
- **Stretch goal:** Manipulate the sales data such that it looks like the output on the right.
]
]

.pull-left[

```
## # A tibble: 9 x 2
##   id      n    
##   &lt;chr&gt;   &lt;chr&gt;
## 1 Brand 1 n    
## 2 1234    8    
## 3 8721    2    
## 4 1822    3    
## 5 Brand 2 n    
## 6 3333    1    
## # ... with 3 more rows
```
]
.pull-right[

```
## # A tibble: 7 x 3
##   brand      id     n
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Brand 1  1234     8
## 2 Brand 1  8721     2
## 3 Brand 1  1822     3
## 4 Brand 2  3333     1
## 5 Brand 2  2156     3
## 6 Brand 2  3987     6
## # ... with 1 more row
```
]



---

class: middle

# Case study: Religion and income

---

&lt;img src="img/relig-income.png" width="75%" style="display: block; margin: auto;" /&gt;

.footnote[
Source: [pewforum.org/religious-landscape-study/income-distribution](https://www.pewforum.org/religious-landscape-study/income-distribution/), Retrieved 14 April, 2020
]

---

## Read data 


```r
library(readxl)
rel_inc &lt;- read_excel("data/relig-income.xlsx")
```

.small[

```
## # A tibble: 12 x 6
##   `Religious tradition`         `Less than $30,~ `$30,000-$49,99~
##   &lt;chr&gt;                                    &lt;dbl&gt;            &lt;dbl&gt;
## 1 Buddhist                                  0.36             0.18
## 2 Catholic                                  0.36             0.19
## 3 Evangelical Protestant                    0.35             0.22
## 4 Hindu                                     0.17             0.13
## 5 Historically Black Protestant             0.53             0.22
## 6 Jehovah's Witness                         0.48             0.25
## # ... with 6 more rows, and 3 more variables:
## #   $50,000-$99,999 &lt;dbl&gt;, $100,000 or more &lt;dbl&gt;,
## #   Sample Size &lt;dbl&gt;
```
]

---

## Rename columns

.midi[

```r
rel_inc %&gt;%
  rename( 
    religion = `Religious tradition`, 
    n = `Sample Size` 
  ) 
```

```
## # A tibble: 12 x 6
##   religion     `Less than $30,~ `$30,000-$49,99~ `$50,000-$99,99~
##   &lt;chr&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 Buddhist                 0.36             0.18             0.32
## 2 Catholic                 0.36             0.19             0.26
## 3 Evangelical~             0.35             0.22             0.28
## 4 Hindu                    0.17             0.13             0.34
## 5 Historicall~             0.53             0.22             0.17
## 6 Jehovah's W~             0.48             0.25             0.22
## # ... with 6 more rows, and 2 more variables:
## #   $100,000 or more &lt;dbl&gt;, n &lt;dbl&gt;
```
]

---

.question[
If we want a new variable called `income` with levels such as "Less than $30,000", "$30,000-$49,999", ... etc. which function should we use?
]


```
## # A tibble: 48 x 4
##    religion                   n income            proportion
##    &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;
##  1 Buddhist                 233 Less than $30,000       0.36
##  2 Buddhist                 233 $30,000-$49,999         0.18
##  3 Buddhist                 233 $50,000-$99,999         0.32
##  4 Buddhist                 233 $100,000 or more        0.13
##  5 Catholic                6137 Less than $30,000       0.36
##  6 Catholic                6137 $30,000-$49,999         0.19
##  7 Catholic                6137 $50,000-$99,999         0.26
##  8 Catholic                6137 $100,000 or more        0.19
##  9 Evangelical Protestant  7462 Less than $30,000       0.35
## 10 Evangelical Protestant  7462 $30,000-$49,999         0.22
## 11 Evangelical Protestant  7462 $50,000-$99,999         0.28
## 12 Evangelical Protestant  7462 $100,000 or more        0.14
## 13 Hindu                    172 Less than $30,000       0.17
## 14 Hindu                    172 $30,000-$49,999         0.13
## 15 Hindu                    172 $50,000-$99,999         0.34
## # ... with 33 more rows
```

---

## Pivot longer

.midi[

```r
rel_inc %&gt;%
  rename(
    religion = `Religious tradition`,
    n = `Sample Size`
  ) %&gt;%
  pivot_longer( 
    cols = -c(religion, n),   # all but religion and n 
    names_to = "income",  
    values_to = "proportion" 
  ) 
```

```
## # A tibble: 48 x 4
##   religion     n income            proportion
##   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;
## 1 Buddhist   233 Less than $30,000       0.36
## 2 Buddhist   233 $30,000-$49,999         0.18
## 3 Buddhist   233 $50,000-$99,999         0.32
## 4 Buddhist   233 $100,000 or more        0.13
## 5 Catholic  6137 Less than $30,000       0.36
## 6 Catholic  6137 $30,000-$49,999         0.19
## # ... with 42 more rows
```
]

---

## Calculate frequencies

.midi[

```r
rel_inc %&gt;%
  rename(
    religion = `Religious tradition`,
    n = `Sample Size`
  ) %&gt;%
  pivot_longer(
    cols = -c(religion, n), 
    names_to = "income", 
    values_to = "proportion"
  ) %&gt;%
  mutate(frequency = round(proportion * n)) 
```

```
## # A tibble: 48 x 5
##   religion     n income            proportion frequency
##   &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;
## 1 Buddhist   233 Less than $30,000       0.36        84
## 2 Buddhist   233 $30,000-$49,999         0.18        42
## 3 Buddhist   233 $50,000-$99,999         0.32        75
## 4 Buddhist   233 $100,000 or more        0.13        30
## 5 Catholic  6137 Less than $30,000       0.36      2209
## 6 Catholic  6137 $30,000-$49,999         0.19      1166
## # ... with 42 more rows
```
]

---

## Save data


```r
rel_inc_long &lt;- rel_inc %&gt;% 
  rename(
    religion = `Religious tradition`,
    n = `Sample Size`
  ) %&gt;%
  pivot_longer(
    cols = -c(religion, n), 
    names_to = "income", 
    values_to = "proportion"
  ) %&gt;%
  mutate(frequency = round(proportion * n))
```

---

## Barplot


```r
ggplot(rel_inc_long, aes(y = religion, x = frequency)) +
  geom_col()
```

&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-107-1.png" width="65%" style="display: block; margin: auto;" /&gt;

---

## Recode religion

.panelset[

.panel[.panel-name[Recode]

```r
rel_inc_long &lt;- rel_inc_long %&gt;%
  mutate(religion = case_when(
    religion == "Evangelical Protestant"           ~ "Ev. Protestant",
    religion == "Historically Black Protestant"    ~ "Hist. Black Protestant",
    religion == 'Unaffiliated (religious "nones")' ~ "Unaffiliated",
    TRUE                                           ~ religion
  ))
```
]

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-109-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

]

---

## Reverse religion order

.panelset[

.panel[.panel-name[Recode]

```r
rel_inc_long &lt;- rel_inc_long %&gt;%
  mutate(religion = fct_rev(religion)) 
```
]

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-111-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

]

---

## Add income

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/rel-income-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) + 
  geom_col() 
```
]

]

---

## Fill bars

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/rel-income-fill-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +
  geom_col(position = "fill")
```
]

]

---

## Change colors

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/rel-income-fill-viridis-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +
  geom_col(position = "fill") +
  scale_fill_viridis_d()
```
]

]

---


## Change theme

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/rel-income-fill-viridis-minimal-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +
  geom_col(position = "fill") +
  scale_fill_viridis_d() +
  theme_minimal() 
```
]

]

---

## Move legend to the bottom

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/bottom-legend-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +
  geom_col(position = "fill") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(legend.position = "bottom")
```
]

]

---

## Legend adjustments

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-117-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +
  geom_col(position = "fill") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE)) 
```
]

]

---

## Fix labels

.panelset[

.panel[.panel-name[Plot]
&lt;img src="u2-Jumbo03-u2-10-11-12-13_files/figure-html/unnamed-chunk-118-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

.panel[.panel-name[Code]

```r
ggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +
  geom_col(position = "fill") +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +
  labs(
    x = "Proportion", y = "", 
    title = "Income distribution by religious group", 
    subtitle = "Source: Pew Research Center, Religious Landscape Study", 
    fill = "Income" 
    )
```
]

]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
